<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="activatr">
<title>Handling Speed and Pace with activatr • activatr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Handling Speed and Pace with activatr">
<meta property="og:description" content="activatr">
<meta property="og:image" content="https://dschafer.github.io/activatr/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">activatr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/activatr.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/pace.html">Handling Speed and Pace with activatr</a>
    <a class="dropdown-item" href="../articles/parsing.html">Advanced Parsing with activatr</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/dschafer/activatr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Handling Speed and Pace with activatr</h1>
                        <h4 data-toc-skip class="author">Daniel
Schafer</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dschafer/activatr/blob/HEAD/vignettes/pace.Rmd" class="external-link"><code>vignettes/pace.Rmd</code></a></small>
      <div class="d-none name"><code>pace.Rmd</code></div>
    </div>

    
    
<p><code>activatr</code> has utility functions to easily annotate a GPX
DF with information about the speed (and corresponding pace) of an
activity.</p>
<p>First, let’s parse our sample GPX DF:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dschafer/activatr" class="external-link">activatr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; The legacy packages maptools, rgdal, and rgeos, underpinning the sp package,</span></span>
<span><span class="co">#&gt; which was just loaded, will retire in October 2023.</span></span>
<span><span class="co">#&gt; Please refer to R-spatial evolution reports for details, especially</span></span>
<span><span class="co">#&gt; https://r-spatial.org/r/2023/05/15/evolution4.html.</span></span>
<span><span class="co">#&gt; It may be desirable to make the sf package available;</span></span>
<span><span class="co">#&gt; package maintainers should consider adding sf to Suggests:.</span></span>
<span><span class="co">#&gt; The sp package is now running under evolution status 2</span></span>
<span><span class="co">#&gt;      (status 2 uses the sf package in place of rgdal)</span></span>
<span></span>
<span><span class="co"># Get the running_example.gpx file included with this package.</span></span>
<span><span class="va">filename</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span></span>
<span>  <span class="st">"extdata"</span>,</span>
<span>  <span class="st">"running_example.gpx.gz"</span>,</span>
<span>  package <span class="op">=</span> <span class="st">"activatr"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/parse_gpx.html">parse_gpx</a></span><span class="op">(</span><span class="va">filename</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">lat</th>
<th align="right">lon</th>
<th align="right">ele</th>
<th align="left">time</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">37.80405</td>
<td align="right">-122.4267</td>
<td align="right">17.0</td>
<td align="left">2018-11-03 14:24:45</td>
</tr>
<tr class="even">
<td align="right">37.80406</td>
<td align="right">-122.4267</td>
<td align="right">16.8</td>
<td align="left">2018-11-03 14:24:46</td>
</tr>
<tr class="odd">
<td align="right">37.80408</td>
<td align="right">-122.4266</td>
<td align="right">17.0</td>
<td align="left">2018-11-03 14:24:48</td>
</tr>
<tr class="even">
<td align="right">37.80409</td>
<td align="right">-122.4266</td>
<td align="right">17.0</td>
<td align="left">2018-11-03 14:24:49</td>
</tr>
<tr class="odd">
<td align="right">37.80409</td>
<td align="right">-122.4265</td>
<td align="right">17.2</td>
<td align="left">2018-11-03 14:24:50</td>
</tr>
</tbody>
</table>
<p>This has information about location and time, but it’s often useful
to visualize the “mile pace” over the course of an activity, especially
for runs.</p>
<p>The first thing to add to the table is the speed.
<code>mutate_with_speed</code> is a wrapper around
<code>dyplr::mutate</code> that will add a <code>speed</code> column to
the data frame:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mutate_with_speed.html">mutate_with_speed</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">lat</th>
<th align="right">lon</th>
<th align="right">ele</th>
<th align="left">time</th>
<th align="right">speed</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">37.80405</td>
<td align="right">-122.4267</td>
<td align="right">17.0</td>
<td align="left">2018-11-03 14:24:45</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">37.80406</td>
<td align="right">-122.4267</td>
<td align="right">16.8</td>
<td align="left">2018-11-03 14:24:46</td>
<td align="right">1.872248</td>
</tr>
<tr class="odd">
<td align="right">37.80408</td>
<td align="right">-122.4266</td>
<td align="right">17.0</td>
<td align="left">2018-11-03 14:24:48</td>
<td align="right">2.253735</td>
</tr>
<tr class="even">
<td align="right">37.80409</td>
<td align="right">-122.4266</td>
<td align="right">17.0</td>
<td align="left">2018-11-03 14:24:49</td>
<td align="right">2.897343</td>
</tr>
<tr class="odd">
<td align="right">37.80409</td>
<td align="right">-122.4265</td>
<td align="right">17.2</td>
<td align="left">2018-11-03 14:24:50</td>
<td align="right">3.052919</td>
</tr>
</tbody>
</table>
<p>However, speed (in meters per second) isn’t the most useful metric
for runs; mile pace (in minutes and seconds) is a more common
measurement. We can convert <code>speed</code> to <code>pace</code>
using <code>speed_to_mile_pace</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span><span class="op">$</span><span class="va">pace</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/speed_to_mile_pace.html">speed_to_mile_pace</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">speed</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="10%">
<col width="11%">
<col width="5%">
<col width="22%">
<col width="10%">
<col width="39%">
</colgroup>
<thead><tr class="header">
<th align="right">lat</th>
<th align="right">lon</th>
<th align="right">ele</th>
<th align="left">time</th>
<th align="right">speed</th>
<th align="right">pace</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">37.80405</td>
<td align="right">-122.4267</td>
<td align="right">17.0</td>
<td align="left">2018-11-03 14:24:45</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">37.80406</td>
<td align="right">-122.4267</td>
<td align="right">16.8</td>
<td align="left">2018-11-03 14:24:46</td>
<td align="right">1.872248</td>
<td align="right">859.576124817367s (~14.33 minutes)</td>
</tr>
<tr class="odd">
<td align="right">37.80408</td>
<td align="right">-122.4266</td>
<td align="right">17.0</td>
<td align="left">2018-11-03 14:24:48</td>
<td align="right">2.253735</td>
<td align="right">714.076761675982s (~11.9 minutes)</td>
</tr>
<tr class="even">
<td align="right">37.80409</td>
<td align="right">-122.4266</td>
<td align="right">17.0</td>
<td align="left">2018-11-03 14:24:49</td>
<td align="right">2.897343</td>
<td align="right">555.453786757008s (~9.26 minutes)</td>
</tr>
<tr class="odd">
<td align="right">37.80409</td>
<td align="right">-122.4265</td>
<td align="right">17.2</td>
<td align="left">2018-11-03 14:24:50</td>
<td align="right">3.052919</td>
<td align="right">527.147986594496s (~8.79 minutes)</td>
</tr>
</tbody>
</table>
<p>Finally, while <code>pace</code> here is a <code>lubridate</code>
duration object, it’s most easily understood in a “MM:SS” format:
<code>pace_formatter</code> is provided for that: contrast the
readability of the two pace graphs below, the first plotting pace
unmodified, the second reversing the axis and adding the formatter.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">pace</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">1200</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">pace</span><span class="op">)</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">pace</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">1200</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">pace</span><span class="op">)</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_reverse</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">pace_formatter</span><span class="op">)</span></span></code></pre></div>
<p><img src="pace_files/figure-html/paceformatter-1.png" width="700"><img src="pace_files/figure-html/paceformatter-2.png" width="700"></p>
<p>Note that the speed and pace are calculated at every point, so they
will often be somewhat noisy. Computing the rolling mean of the speed to
smooth out the graph would be numerically inaccurate, so
<code>mutate_with_speed</code> provides helper arguments to allow the
speed to be computed over larger windows.</p>
<p>In particular, it has <code>lag</code> and <code>lead</code> (which
default to <code>1</code> and <code>0</code> respectively), which
determines the “start” and “end” points used for the speed computation.
So if we wanted each point’s speed to be determined using the points ten
ahead and ten behind and plot that, we could do:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mutate_with_speed.html">mutate_with_speed</a></span><span class="op">(</span><span class="va">df</span>, lead <span class="op">=</span> <span class="fl">10</span>, lag <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">pace</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/speed_to_mile_pace.html">speed_to_mile_pace</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">speed</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">pace</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">1200</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">pace</span><span class="op">)</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_reverse</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">pace_formatter</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Time"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Pace"</span><span class="op">)</span></span></code></pre></div>
<p><img src="pace_files/figure-html/leadlag-1.png" width="700"></p>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Daniel Schafer.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
